@page "/profile"
@using BlazorGoolgeClient.ViewModels
@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims
@inject IProfileViewModel profileViewModel
@inject NavigationManager navigationManager

<h2>
	<b>Profile</b>
</h2>
<hr/>

<div class="col-8">
	<input type="text" @bind-value="profileViewModel.FirstName" class="form-control" placeholder="first name">
	<br/>
	<input type="text" @bind-value="profileViewModel.LastName" class="form-control" placeholder="last name">
	<br/>
	<input type="text" @bind-value="profileViewModel.EmailAddress" class="form-control" placeholder="email address">
	<br/>
	<textarea class="form-control" @bind="profileViewModel.AboutMe" placeholder="about me"></textarea>
	<br/>
	<button class="btn btn-primary" @onclick="profileViewModel.UpdateProfile">Update Profile</button>
	<span>&nbsp;&nbsp;</span>@profileViewModel.Message
</div>


@code {
	[CascadingParameter]
	public Task<AuthenticationState> authenticationState { get; set; }

	protected override async Task OnInitializedAsync()
	{
		var authState = await authenticationState; //_authenticationStateProvider.GetAuthenticationStateAsync();
		var user = authState.User;
		if (user.Identity.IsAuthenticated)
		{
			var claim = user.FindFirst(c => c.Type == ClaimTypes.NameIdentifier);
			profileViewModel.UserId = Convert.ToInt64(claim?.Value);
			await profileViewModel.GetProfile();
		}
		else
		{
			navigationManager.NavigateTo("/");
		}
	}

}